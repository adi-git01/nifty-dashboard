name: Market Alerts

on:
  schedule:
    # Run every hour from 9 AM to 4 PM UTC (approx Indian Market hours + buffer)
    # India is UTC+5:30. Market 9:15 AM - 3:30 PM IST = 3:45 AM - 10:00 AM UTC.
    # We'll run it every hour 24/7 for now to catch crypto/global or just simple daily checks.
    - cron: '0 * * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  check-alerts:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    - name: Install dependencies
      run: |
        pip install pandas yfinance requests numpy
        
    - name: Run DNA3 Portfolio Scan
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        python dna3_current_portfolio.py
        python dna3_morning_alert.py
      
    - name: Commit changes (if positions updated)
      # This is critical if we want to update "last checked" timestamp or similar in json
      # For now, we only READ positions, so no need to commit back.
      # If we implement "auto-close" or "disable alert after trigger", we need this.
      run: echo "No changes to commit"
